# LEXICAL ENVIRONMENT

## About
- Это скрытый объект (объект LexicalEnvironment) выполняемой функции или выполняемого блока.
- Автоматически создается (уникальное) при:
  - запуске функции (каждом!).
  - выполнении любого блока кода: `{...}`
  - для КАЖДОЙ итерации внутри циклов.  
  В случае с циклами во внутреннее LE входят переменные между инструкцией цикла `for`/ `while` и `{}`.
- Автоматически уничтожается тогда, когда не остается ссылающихся на него [[Environment]].

## LE-object structure
- Состоит из двух частей: объект Environment Record, [[Environment]].
- Environment Record – объект, в котором как свойства хранятся
  - Все локальные переменные.  
  В этом смысле переменные - это свойства этого объекта: Environment Record. «Получить или изменить переменную», означает, «получить или изменить свойство этого объекта».
  - Параметры функции.
  - Значение this.
  - Др.
- [[Environment]] - ссылка на лексическое окружение места, в котором была создана рассматриваемая функция.
- Способ хранения информации: идентификатор-переменная.
  - идентификатор ссылается на имя переменной/функции
  - переменная ссылвется на сам объект (включая функциональный объект) или на примитивное значение.
- Концептуальный вид:

  ```
  lexicalEnvironment = {
    environmentRecord: {
      <identifier> : <value>,
      <identifier> : <value>
    }
    outer: < Reference to the parent lexical environment>
  }
  ```

## Поиск переменных в LE
- Изначально поиск происходит в Environment Record.
- Если искомой переменной не найдено - переход осуществляется по цепочке в последующих внешних LE.
- При обнаружении искомой переменной - берется ее актуальное для данного лексического окружения значение.

## LE features

### Изоляция глобальных переменных 
- Это способ изоляции переменных из глобальной области видимости в локальную.
- Для этого необходимо создать "простой" блок и поместить туда переменные. После этого они принадлежат локальной области видимости этого блока:

# CLOSURE

## About
- Это функция, которая имеет доступ к своему внешнему окружению, даже после того, как внешняя функция возвращена.

## Механизм замыкания
<<-R
1. Имеется функция с переменными.  
Внутри нее имеется внутренняя функция, которая: 
    - имеет ссылки на переменные внешней функции
    - возвращается внешней функцией.  
1. Создается переменная, которой присваивается результат вызова внешней функции - внутренняя функция.  
При присвоении вызова:
    - вызывается эта функция
    - создается ее LE
    - выполняется функция
    - происходят процессы, которые присваивают ссылку на LE внешней функции со стороны LE внутренней.
    - действие функции завершается
    - LE не удаляется, т.к. на него ссылается LE внутренней функции.
1. На созданной переменной вызываем внутреннюю функцию.
1. Из-за вызова она создает новое LE, ссылающееся на сохраненное LE вызванной ранее внешней функции.
1. Результат работы внутренней функции изменяет переменные внешней.
1. При последующих вызовах последние два пункта повторяются.

Таким образом, при помощи ссылки функция замыкает на себе LE, которое в иной ситуации должно было бы удалиться из движка, и имеет возможность манипулировать переменными этого LE.  
R->>

# SCOPE

## About
- <<Это физические места в коде, из которых видна переменная, про видимость которой идет речь>>

## Scope types
- Собственный
- Глобальный

## Resources
- [learn.javascript / closures](https://learn.javascript.ru/closure)
- [nuancesprog.ru](https://nuancesprog.ru/p/2539/)