# Основы

## Что это такое?

Средство поиска и замены данных в строке.

## Архитектура

Реализован самостоятельным объектом RegExp.

Представлен шаблоном (использовать обязательно) и набором флагов (использовать опционально).

РГ взаимодействует со строкой через определенные методы:
- Замена
- Поиск
- Проверка

# Создание

## Через new RegExp

Синтаксис: 
```
let regexp = new RegExp('шаблон', 'флаги')
```
- Способ допускает вставку переменных через ${}
- Символы необходимо экранировать.

## Через шаблон

Синтаксис: 
```
let regexp = /шаблон/флаги
```
- Способ не допускает вставку переменных

# Флаги

## Виды

`i`  - Независимость от регистра.  
`g`  - Работа со ВСЕМИ совпадениями (не только с первым).  
`m` - Многострочный режим.  
В этом режиме якоря работают с каждой строкой многострочного текста.  
`s` - Режим dotail.  
В этом режиме символьный класс "точка" включает в т.ч. и перевод строки.  
`u` - Полная поддержка юникода.  
В этом режиме 4-байтные символы не рассматриваются как два 2-байтные.
`y` - Поиск по конкретной позиции.

# Методы взаимодействия со строкой

## Поиск

### Через match

Синтаксис: 
```
str.match(regexp)
```
- Без флага g: возвращает первое совпадение в виде массива со скобочными группами и свойствами.
- C флагом g: возвращает все совпадения в виде массива без скобочных групп и других деталей.
- При отсутствии совпадений - возвращается null.

### Через matchAll

Возвращает перебираемый объект с результатами (не массив).

Синтаксис:
```
str.matchAll(regexp)
```

- Каждое совпадение возвращается в виде массива со скобочными группами.
- При отсутствии совпадений - возвращается null.

### Через search

Синтаксис: 
```
str.search(regexp)
```

- Возвращает строго первое совпадение с РВ.
- Если совпадения отсутствуют - возвращает -1

### Через test

Синтаксис: 
```
regexp.test(str)
```

- Ищет совпадение и возвращает boolean.
- Возможен поиск с заданной позиции.  
Для этого нужно ее задать через lastIndex, а также установить РВ g-флаг.  
Cинтаксис: 
  ```
  regexp.lastIndex = 3
  ```

### Через esec

Синтаксис: 
```
regexp.exec(str)
```

- Без флага g: возвращает первое совпадение в виде массива со скобочными группами и свойствами.
- C флагом g: возвращает первое совпадение и запоминает позицию после него в свойстве regexp.lastIndex. Следующий такой вызов начинает поиск с позиции regexp.lastIndex и возвращает следующее совпадение.
- Возможен поиск с заданной позиции.  
Для этого нужно ее задать через lastIndex, а также установить РВ g-флаг.  
Cинтаксис: 
  ```
  regexp.lastIndex = 3
  ```
- Если у регулярного выражения стоит флаг y, то поиск будет вестись ТОЛЬКО на позиции regexp.lastIndex (и не далее).

## Замена

Синтаксис:
```
str.replace(regexp, 'заменяющий текст')
```

- По умолчанию заменяет первое совпадение (для замены ВСЕХ совпадений - использовать флаг g).

## Проверка

Синтаксис: 
```
regexp.test(str)
```

- Метод проверяет, есть ли хотя бы одно совпадение в строке.  
Возвращает bool

# Синтаксические конструкции

Внутри шаблона используются синтаксические конструкции, позволяющие гибко работать с привязанной к РГ строкой. 

## Виды

- символьные классы;
- работа со свойствами юникод-символов;
- якоря;
- наборы и диапазоны;
- символ проверки границы слов;
- экранирование;

# Символьные классы

## Что это?

Это специальное обозначение, которое соответствует любому символу из определённого набора.

## Виды

- Цифры  
`\d` - Цифры от 0 до 9
- Пробельные символы  
`\s` - Пробел
- Табуляция: `\t`
- Перевод строки: `\n`
- Буквы  
`\w` - Буквы латинского алфавита: 
- Обратные классы  
Это классы, которые необходимо исключить из работы.
Синтаксис: символ исключаемого класса в верхнем регистре (`\D \S \W`).
- Все символы: `.`  
Обозначает любой символ, кроме новой строки.  
Для учета также и новой строки - использовать режим dotail (флаг s).

## Правила использования

- По умолчанию производится поиск первого символа набора в строке. 
- Для поиска всех символов в строке - использовать флаг g.
- Можно комбинировать несколько символьных классов, а также классы с другими синтаксическими конструкциями.  
Пример: \d\s\w будет искать (заменять, проверять) в строке конструкции типа "1 q".

# Cвойства юникод-символов

## Что это?

Юникод-символ имеет ряд свойств, его характеризующих: letter, number и др (список ниже).  
При помощи регулярных выражений можно работать с символами, обладающими конкретными свойствами.

## Как работать со свойствами символов?

Синтаксис: 
```
/\p{свойство}/u
```

- Флаг u - обязателен к использованию.
- По умолчанию работа производится только с первым символом, содержащим указанное свойство. Для работы со всеми символами - использовать флаг g.

## Основные свойства символов

- Буквы: L
  - в нижнем регистре: Ll
  - модификаторы: Lm
  - заглавные буквы: Lt
  - в верхнем регистре: Lu
  - прочие: Lo
- Числа: N
  - десятичная цифра: Nd
  - цифры обозначаемые буквами (римские): Nl
  - прочие: No
- Знаки пунктуации: P
  - соединители: Pc
  - тире: Pd
  - открывающие кавычки: Pi
  - закрывающие кавычки: Pf
  - открывающие скобки: Ps
  - закрывающие скобки: Pe
  - прочее: Po
- Отметки (например, акценты): M
  - двоеточия: Mc
  - вложения: Me
  - апострофы: Mn
- Символы: S
  - валюты: Sc
  - модификаторы: Sk
  - математические: Sm
  - прочие: So
- Разделители: Z
  - линия: Zl
  - параграф: Zp
  - пробел: Zs
- Язык: sc=значение
- Прочие: C
  - контрольные: Cc
  - форматирование: Cf
  - не назначенные: Cn
  - для приватного использования: Co
  - суррогаты: Cs

# Якоря

## Что это?

Специальные символы, указывающие на начало и конец строки.  
Используются для того, чтобы проверить, начинается (заканчивается) ли строка указанной подстрокой.  
В качестве подстроки могут выступать не только буквы, но и другие синтаксические конструкции. Например, символьные классы.

## Как использовать?

__Начинается ли строка с подстроки__

Следует использовать в начале шаблона символ каретки ^, означающий "начало строки":  
`^Ruslan`

__Заканчивается ли строка подстрокой__

Следует использовать в конце шаблона символ доллара $, обозначающий "конец строки":  
`Ruslan$`

__Совпадает ли строка полностью__

Комбинируя оба символа, можно проверить строку на полное совпадение:  
`^Ruslan$`

__Многостраничный режим__

Если проверяемый текст состоит из нескольких строк, то при активации многострочного режима будет производиться проверка начала (конца) КАЖДОЙ строки.  
Синтаксис активации: 
```
/шаблон/m
```

# Символ проверки границы слова

## Что это?

Специальный символ (\b), проверяющий, является ли последующий (предшествующий) данному символу символ началом или концом слова или числа.

## Как использовать?

Принцип работы следующий:  
С одной стороны \b должно находиться \d или \w, а с другой - не \w  
Пример:  
Поиск отдельно стоящего слова Hello: `\bHello\b`
Поиск отдельно стоящего двузначного числа: `\b\d\d\b` 

# Экранирование

## Что это?

Способ работы с элементами в их буквальном значении: с точкой как с точкой, кареткой как кареткой и т.д.  
Экранируемые символы: [   \  /  ^   $   .   |   ?   *   +   (   )

## Как использовать?

Перед требуемым символом необходимо поставить обратный слеш `\`

# Наборы и диапазоны

## Что это?

В шаблоне можно указать символы, с ЛЮБЫМ одним из которых необходимо произвести работу.

## Как использовать?

1. Требуемые символы необходимо поместить в [скобки]: [набор (или диапазон)]
2. Для того, чтобы работать со всеми входящими в строку значениями, указанными в диапазоне, следует поставить флаг `g`.
3. В скобки символы можно помещать двумя способами: набором или диапазоном.

## Особые случаи

### Исключающий диапазон

Набор (или диапазон) можно трансформировать в исключающий: т.е. работать надо будет со всеми символами, не входящими в набор (или диапазон).  
Для этого внутри [скобок] перед набором (или диапазоном) необходимо указать каретку: `[^набор]`

### Комбинированный диапазон

Набор (или диапазон) можно комбинировать с простыми символами.
Пример: /В[уа]ля

## Наборы

Наборы - это строгое перечисление символов , с любым из которых необходимо произвести работу.  
Синтаксис: 
```
[abc]
```
## Диапазоны

Диапазоны - это символы, находящиеся между символами, прописанными в диапазоне, с любым из которых необходимо произвести работу.  
Синтаксис: 
```
[a-z]
```

Если необходимо произвести работу с несколькими диапазонами, то их необходимо перечислить внутри [скобок] без пробела.  
Синтаксис: 
```
[a-z0-9]
```
Диапазон можно переписать на соответствующую диапазону синтаксическую конструкцию: символьный класс, юникод - свойства и др.  
Синтаксис:
```
[0-9] >>> [\d]
[А-Я] >>> [\p{sc=cyrillic}]
```

# Скобочные группы

## Что это?

Скобочная группа - это синтаксическая конструкция, при которой часть шаблона оборачивается в (круглые скобки), что позволяет:
- применять квантификаторы ко всей комбинации символов, находящейся внутри скобок.
- создать массив из входящих в скобочную группу скобочных групп.

## Как создать массив из скобочных групп

### Через match

Возвращает массив, содержащий следующие элементы: 
- совпадение целиком
- совпадение с первой скобочной группой.
- совпадение с первой вложенной группой
- совпадение со второй вложенной группой
- т.д.

При использовании флага g возвращает массив, содержащий:
- совпадение целиком
- недетализированная первая скобочная группа
- недетализированная вторая скобочная группа
- т.д.

Синтаксис:
```
let str = '<h1>Hello, world!</h1>'
let arr = str.match(/<(.*?)>/)
arr[0] = <h1>
arr[1] = h1
```

### Через matchAll

Возвращает перебираемый объект (в отличие от match, который возвращает сразу массив).  
При использовании флага g возвращает перебираемый объект, который затем при необходимости можно перевести в массив при помощи деструктуризации или Array.from().

## Именование скобочной группы

Скобочной группе можно присвоить уникальное имя. Это необходимо для упрощения работы с ней: позволит обращаться к ней не через индексное значение, а по имени.  
Синтаксис: 
```
(?<name>...)
```
Если группе не присвоено имя, то к ней можно обращаться без именования через $n, где n - порядковый номер скобочной группы.

## Исключение скобочной группы

Если необходимо исключить отображение конкретной скобочной группы в результате, ее можно исключить из него.  
Синтаксис исключения: 
```
(?...)
```
Это полезно в следующих случаях:
- В работе с необязательными скобочными группами -  группами, которые в ряде случаев возвращают значение undefined. Это возможно в случаях, когда определение произошло через квантификатор (...)?
- Если необходимо применить квантификатор ко всей группе, но не запоминать их содержимое в отдельном элементе массива-результата.

## Перемещение скобочных групп

Существует возможность редактирования порядка отображения элементов внутри строки.  
Эта возможность позволяет менять порядок отображения даты, изменение ФИО и т.д.

### Алгоритм перемещения:

1. Определить шаблон для скобочной группы для str. 
1. Инициализировать метод str.replace(regexp, replacement);  
В качестве regexp указываем определенный выше шаблон (либо переменную, в которой мы его определили)  
В качестве replacement указываем в виде строки в требуемом порядке сортировки ‘ $n, $n, $n’.
n - это индексный номер скобочной группы. Вместо него можно использовать присвоенное группе имя.

# Квантификаторы

## Что это?

Это синтаксическая конструкция, позволяющая указать, со сколькими  n в ряд повторениями требуемой синтаксической конструкции необходимо работать.  
Пример: 
```
\d\d\d\d\d => \d{5}
```

## Виды

- `{n}`
- `+`
- `?`
- `*`

## {n}

Квантификатор, указывающий на количество повторяющихся элементов, с которыми необходимо работать.

__Указать количество повторений__

Необходимо после синтаксической конструкции в фигурных скобках указать число обязательных повторений данной конструкции.

_Пример_  
Произвести действия со стоящими в ряд пятью цифрами: `\d{5}`

__Указать диапазон повторений__

Необходимо после синтаксической конструкции в фигурных скобках указать диапазон обязательных повторений указанной конструкции.

_Пример_  
Произвести действия с диапазоном от 3-х до 5-ти цифр: `\d{3,5}`  
Произвести действия с диапазоном от 3-х и более цифр: `\d{3,}`

## +

Квантификатор, означающий “Один и более раз”.  
Сокращенная форма записи {1,}

_Пример_  
Произвести действия с цифрами, повторяющимися несколько раз: `\d+`

## ?

Квантификатор, означающий “Ноль или один раз”.  
Сокращенная форма записи {0,1}

_Пример_  
`colou?r` найдёт два варианта: color и colour

## *

Квантификатор, означающий “Ноль или более”.  
Сокращенная форма записи {0,}

_Пример_  
`\d0*` находит цифру и все нули за ней (их может быть много или ни одного)

## Режимы работы

__Жадный режим__

В этом режиме квантификатор повторяется столько раз, сколько это возможно.  
Режим включен по умолчанию.

_Пример_  
Имеем строку 'a "witch" and her "broom" is one'.  
Шаблон /".+"/g ловит кавычку с “точкой” на третьей и четвертой позиции.
Далее шаблон ловит все совпадения с “точкой”, в том числе сжевывая кавычки, которые также входят в “точку”. При этом он не проверяет совпадение с кавычкой.
В результате движок доходит до конца строки, и, “осознав ошибку”, начинает отступать, в поисках ближайшей кавычки.
Итоге: "witch" and her "broom" вместо "witch", "broom"

__Ленивый режим__

В этом режиме движок пытается найти совпадение для оставшегося шаблона перед каждым повторением квантификатора.  
Режим включается с помощью знака вопроса ? после квантификатора. 
Несмотря на то, что ? сам по себе является квантификатором, при использовании после другого квантификатора он играет роль не квантификатора, а включателя режима ленивого поиска.  
Синтаксис: `.+?`

## Квантификация нескольких символов

Если квантификатор необходимо применить к конструкции, состоящей из нескольких символов (или синтаксических конструкций), то данную конструкцию необходимо поместить в скобочную группу.  
_Пример_  
Без скобочной группы: `go{3} >>> gooo`  
Со скобочной группой: `(go){3} >>> gogogo`

# Обратные ссылки

## Что это?

Это способ обращения к скобочной группе внутри самого шаблона.
Таким образом, к скобочной группе можно обращаться не только через результат поиска.

## Как создать?

Внутри шаблона в требуемом месте следует указать конструкцию, сконструированную по одному из следующих вариантов.

__1 вариант__

Обращение к индексному номеру скобочной группы: \N

__2 вариант__

Обращение к имени скобочной группы: \k<name>

_Пример использования_

Задача  
Найти одинарные или двойные кавычки в строке.  
Трудности
При использовании ['"](.*?)['"] есть вероятность получения следующего результата: “name‘.  
Решение  
Используя обратные ссылки, можно создать следующий шаблон: `(['"])(.*?)\1`  
В данном случае результат будет удовлетворительным, т.к. механика действий следующая: движок регулярных выражений находит первую кавычку из шаблона `(['"])` и запоминает её содержимое.

# Альтерация

## Что это?

Термин, означающий оператор “ИЛИ”.  
Конструкция используется внутри шаблона и означает выбор между частями шаблона, разделенными данным оператором.

## Как использовать?

Синтаксис: `|`

# Опережающие и ретроспективные проверки

##  Что это?

Это способ поиска только тех соответствий шаблону, за или перед которыми находятся определенные данные.
Пример использования данного метода:
- Поиск только тех чисел, вслед за которыми находятся знак “евро”.
Как создать проверку?
Опережающая проверка
Находит X при условии, что за ним следует Y.
Синтаксис: X(?=Y)
Негативная опережающая проверка
Находит X при условии, что за ним НЕ следует Y.
Синтаксис: X(?!Y)
Ретроспективная проверка
Находит X при условии, что перед ним стоит Y.
Синтаксис: (?<=Y)X
Негативная ретроспективная проверка
Находит X при условии, что перед ним НЕ стоит Y.
Синтаксис: (?<!Y)X
Особые случаи
Включить в результат проверки опережающий (или ретроспективный) символ
В результаты проверки по умолчанию не выводится опережающий или ретроспективный символ. 
В случаях, если это необходимо, следует обернуть опережающий (ретроспективный) символ  в (скобки).
MM: Способ не работает с replace (символ не включается)
